"use strict";!function(t,i,e,a){var o=function(i,o){var s={};this.options=t.extend({},s,o),this.$element=t(i),this.$window=t(a),this.$body=t(e.body),this.$backdrop=void 0,this.$lightbox=void 0,this.$loader=void 0,this.$ui=void 0,this.$btnClose=void 0,this.loading=void 0,this.slides=[],this.slideCount=0,this.aspectRatio=void 0,this.clickEvent="click",this.noCaption=!1,this.tabbableElements=t("a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, *[tabindex], *[contenteditable]"),this.init()};o.prototype={init:function(){var t=this,e=t.$element.find("a").has("img");i.touchevents&&(t.clickEvent="click tap"),this.$element.hasClass("gallery")&&this.$element.attr("data-settings").toLowerCase().indexOf("captioninpopup=false")>-1&&(this.noCaption=!0),e.each(function(){t.slides.push({src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",fullSrc:this.href,orientation:"",caption:this.title})}),t.slideCount=t.slides.length-1,t.$element.on(t.clickEvent,"a:has(img)",function(i){i.preventDefault();for(var e=0;e<t.slideCount&&t.slides[e].fullSrc!==this.href;e++);t.open(e)}),t.buildHTML(),a._monoLoader.windowLoaded?(t.setImageAspectRatio(),t.setImageClasses()):this.$window.on("load",function(){t.setImageAspectRatio(),t.setImageClasses()})},open:function(o){var s=this;s.$body.addClass("hide-overflow"),s.$body.append(s.$backdrop),s.$body.append(s.$lightbox),s.$lightbox.imgSlider({container:".lightbox-container",slides:".lightbox-image",previous:".prev",next:".next",index:o,keyboard:!i.touchevents,onChange:function(){s.loadImage(this.currentSlide)}}),a._mtr&&a._mtr.track("gallery_overlay_open"),s.loadImage(o),s.setAspectRatio(),s.setImageClasses(),s.$btnClose.on(s.clickEvent,function(i){if(void 0!==t("body").attr("data-enablefocusindication")&&s.$element.data().monogallery){var e=s.$lightbox.data().slider.currentSlide,a=s.$element.data("settings"),o=new RegExp("imagenr=(\\d+)","i"),n=a.match(o)?parseInt(a.match(o)[1]):void 0;if(n){var l=Math.floor(e/n);s.$element.data().monogallery.changeSlide(l)}}s.close(),i.stopPropagation(),i.preventDefault()}),void 0!==t("body").attr("data-enablefocusindication")&&this.trapFocus(t(".lightbox")),i.touchevents?(s.$ui.addClass("hidden-small"),s.$lightbox.on(s.clickEvent,function(){s.$ui.toggleClass("hidden-small")})):t(e).on("keydown",function(t){27===t.keyCode&&(s.close(),s.$element.find("a").eq(o).trigger("focus"),t.preventDefault())}),s.$window.on("resize.lightbox",t.proxy(s.setAspectRatio,s)),s.$window.on("resize.lightbox",t.proxy(s.setImageClasses,s)),this.toggleTabbingOnPage(!1),this.enableTabbingOnLightbox()},close:function(){this.$backdrop.remove(),this.$lightbox.remove(),this.$body.removeClass("hide-overflow"),this.$window.off("resize.lightbox",t.proxy(self.setAspectRatio,self)),this.$window.off("resize.lightbox",t.proxy(self.setImageClasses,self)),this.toggleTabbingOnPage(!0)},trapFocus:function(t){var i=t.find("a[href]"),a=i[0],o=i[i.length-1],s=9;t.on("keydown",function(t){var i="Tab"===t.key||t.keyCode===s;i&&(t.shiftKey?e.activeElement===a&&(o.trigger("focus"),t.preventDefault()):e.activeElement===o&&(a.trigger("focus"),t.preventDefault()))})},buildHTML:function(){for(var i=this,e="",a=0;a<i.slideCount+1;a++)e+='<div class="lightbox-image" aria-hidden = "true">',e+='<img src="'+i.slides[a].src+'" alt="">',i.noCaption||(e+='<div class="lightbox-caption">'+i.slides[a].caption+"</div>"),e+="</div>";i.$backdrop=t('<div class="lightbox-backdrop"></div>'),i.$lightbox=t('<div class="lightbox" aria-modal="true" role="dialog" aria-label="Gallery"><div class="lightbox-container">'+e+"</div></div>"),i.$loader=t('<div class="lightbox-loading hidden"></div>'),i.$ui=t('<div class="lightbox-ui"></div>'),i.$btnClose=t('<a class="close" aria-label="close" href="#"></a>'),i.$lightbox.append(i.$loader),i.$lightbox.append(i.$ui),i.$ui.append(i.$btnClose),i.slideCount>0&&i.$ui.append(t('<a class="prev" aria-label="previous" href="#"></a><a class="next" aria-label="next" href="#"></a>'))},startLoader:function(){var t=this,i=0;t.loading||(t.loading=setInterval(function(){i=i>-352?i-32:0,t.$loader[0].style.backgroundPosition="0 "+i+"px"},100),t.$loader.removeClass("hidden"))},stopLoader:function(){this.$loader.addClass("hidden"),clearInterval(this.loading),this.loading=void 0},loadImage:function(i){for(var e=this,a=e.$lightbox.find(".lightbox-image").eq(i),o=a.find("img")[0],s=0;s<e.slideCount+1;s++)e.$lightbox.find(".lightbox-image").eq(s).attr("aria-hidden","true");return a.attr("aria-hidden","false"),a.attr("aria-live","polite"),a.on(e.clickEvent,function(t){e.close(),t.stopPropagation(),t.preventDefault()}),o.src===e.slides[i].fullSrc?void a.addClass("lightbox-image-loaded"):(e.startLoader(),void t("<img>").attr("src",e.slides[i].fullSrc).on("load",function(){this.src===e.slides[i].fullSrc&&(a.addClass("lightbox-image-loaded"),o.src=e.slides[i].fullSrc,e.setImageCaptionFontFromGallery(o.src),e.stopLoader())}))},setAspectRatio:function(){this.aspectRatio=this.$lightbox.width()/this.$lightbox.height()},setImageAspectRatio:function(){for(var t=0;t<this.slideCount;t++){var i=this.$element.find("img").eq(t);this.slides[t].aspectRatio=i.width()/i.height()}},setImageCaptionFontFromGallery:function(i){var e=i.match("/uploads/(.*)")[0],a=this.$lightbox.find(".lightbox-caption"),o=t(".module.gallery").find("a[title='"+a.html()+"']").find("img[src='"+e+"']").closest("a").find("span[class*='caption']").css("font-family");a.css("font-family",o)},setImageClasses:function(){for(var t,i,e=0;e<this.slideCount+1;e++)t=this.aspectRatio>this.slides[e].aspectRatio?"lightbox-image-tall":"lightbox-image-wide",i="lightbox-image-wide"===t?"lightbox-image-tall":"lightbox-image-wide",this.$lightbox.find(".lightbox-image").eq(e).removeClass(i).addClass(t)},toggleTabbingOnPage:function(i){var e=i?"0":"-1";t.each(this.tabbableElements,function(i,a){t(a).attr("tabindex",e)})},enableTabbingOnLightbox:function(){t(".lightbox-ui").find(".close, .prev, .next").attr("tabindex",0)}},t.fn.lightbox=function(i){return this.each(function(){t.data(this,"lightbox")||t.data(this,"lightbox",new o(this,i))})},t(function(){t('[data-req*="lightbox"]').lightbox()})}(jQuery,Modernizr,document,window);