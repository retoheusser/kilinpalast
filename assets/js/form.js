"use strict";var _slicedToArray=function(){function t(t,e){var a=[],i=!0,n=!1,r=void 0;try{for(var o,d=t[Symbol.iterator]();!(i=(o=d.next()).done)&&(a.push(o.value),!e||a.length!==e);i=!0);}catch(c){n=!0,r=c}finally{try{!i&&d["return"]&&d["return"]()}finally{if(n)throw r}}return a}return function(e,a){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,a);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_monoForm={isInTool:document.body.hasAttribute("data-istool"),$forms:$(".form"),activeCaptchaForm:null,logsSource:"FORM_HCAPTCHA",init:function(){var t=this,e=this;window._monoLoader.utils.waitFor(function(){return t.$forms.find(".h-captcha").length},function(){window.formsInitHcaptcha=function(){window.hcaptchaInitialized||e.initHcaptcha()}},2e4,50),e.onlyShowOneHCaptchaBadge(),this.$forms.each(function(t,a){e.setConditionals($(a)),e.bindLabelsClick($(a))});var a=this.$forms.find("input[data-type='datepicker']");e.isDesktop()?e.initDatepicker(a):e.initNativeDatepicker(a),e.initLocation(this.$forms.find("input[data-type='location']")),this.$forms.find("a[data-overlay-trigger]").length>0&&this.$forms.find("a[data-overlay-trigger]").monooverlay(),this.addIOSFixForHcaptcha()},addIOSFixForHcaptcha:function(){var t=this,e=/iPhone|iPad|iPod/i.test(navigator.userAgent),a=void 0,i=function(t){var e=t.getBoundingClientRect();return e.top>=0&&e.bottom<=window.innerHeight};if(e){var n=document.querySelectorAll(".h-captcha");window.addEventListener("scroll",function(){Array.prototype.forEach.call(n,function(t){i(t)&&(a=document.documentElement.scrollTop||document.body.scrollTop)})},!1)}window.onHcaptchaSuccess=function(){if(e&&void 0!==a&&window.scrollTo(0,a),t.activeCaptchaForm){var i=t.activeCaptchaForm.getAttribute("data-widgetid");window._monoLoader.utils.waitFor(function(){return hcaptcha.getResponse(i).length},function(){$(t.activeCaptchaForm).find('[name="type"][value="comment"]').length?(t.submitComment(t.activeCaptchaForm),t.activeCaptchaForm=null):(t.submitForm(t.activeCaptchaForm),t.activeCaptchaForm=null)},2e4,100)}}},validateHcaptcha:function(t){var e=this,a=t.getAttribute("data-widgetid");hcaptcha.execute(a,{async:!0}).then(function(a){var i=a.response;i&&($(t).find('[name="type"][value="comment"]').length?(e.submitComment(t),e.activeCaptchaForm=null):(e.submitForm(t),e.activeCaptchaForm=null))})["catch"](function(t){e.logEvent(t),console.error("Hcaptcha validation error: ",t)})},submitForm:function(t){if($(t).length>0){if($(t).find(".h-captcha").attr("data-invisible")&&$(t).find(".h-captcha").attr("data-invisible").length){var e=t.getAttribute("data-widgetid");try{if(!hcaptcha.getResponse(e).length)return this.activeCaptchaForm=t,this.validateHcaptcha(t),!1}catch(a){return this.logEvent(a),console.error("Submit hCaptcha error: ",a),!1}}var i=function(t){var e=$('[name="_ha_seed"]',t).val(),a=$('[name="'+e+'"]',t),i=!1;return a&&(i=0===a.val().length),i};if(i(t)===!1)return!1;this.trimOptionsFromSelectFields(t);var n=this,r=$(t),o=n.validateFields(r);if(n.toggleLoading(r),o.valid){if(!window.FormData)return!0;var d={};r.find("input[data-type='datepicker'][type='date']").each(function(t,e){var a=new DateFormatter,i=new Date(e.value),n=$("body").attr("data-dateformat");d[e.name]=a.formatDate(i,n)});var c=r.serializeArray(),s=new FormData;if(Object.keys(d).length){var l=!0,h=!1,u=void 0;try{for(var p,f=function(){var t=_slicedToArray(p.value,2),e=t[0],a=t[1];c.find(function(t){return t.name===e}).value=a},m=Object.entries(d)[Symbol.iterator]();!(l=(p=m.next()).done);l=!0)f()}catch(a){h=!0,u=a}finally{try{!l&&m["return"]&&m["return"]()}finally{if(h)throw u}}}r.find('input[type="file"]').each(function(t,e){$.each(e.files,function(t,a){c.push({name:e.name,value:a})})}),s.append("currentUrl",window.location.href),$.each(c,function(){s.append(this.name,this.value)}),$.ajax({type:"POST",url:r.attr("data-url"),data:s,contentType:!1,processData:!1,success:function(t){if(t.match(/^\{\"redirect\":.*}$/))return t=JSON.parse(t),void(window.location=t.redirect);var e=$(t);e.find("div.thankYou").length||n.initHcaptcha(e),r.replaceWith(e),r.trigger("focus"),e.find(".h-captcha").length&&(window.hcaptchaInitialized||window.hcaptchaEngagementsInitialized||n.initHcaptcha(e)),n.onlyShowOneHCaptchaBadge(),n.bindLabelsClick(e)},error:function(t){n.toggleLoading(r),413===t.status&&n.showError("requestTooLarge",r)}}),window._mtr&&r.attr("data-track-action")&&window._mtr.track(r.attr("data-track-action"))}else n.toggleLoading(r),n.showFieldErrors(r,o.fields)}return!1},submitComment:function(t){if($(t).find(".h-captcha").attr("data-invisible")&&$(t).find(".h-captcha").attr("data-invisible").length){var e=t.getAttribute("data-widgetid");if(!hcaptcha.getResponse(e).length)return this.activeCaptchaForm=t,this.validateHcaptcha(t),!1}var a=this,i=$(t),n=window.location.href,r=a.validateFields(i);if(a.toggleLoading(i),!window.FormData)return!0;var o=i.serializeArray(),d=new FormData;return i.find('input[type="file"]').each(function(t,e){$.each(e.files,function(t,a){o.push({name:e.name,value:a})})}),$.each(o,function(){d.append(this.name,this.value)}),r.valid?($.ajax({type:"POST",url:n,data:d,contentType:!1,processData:!1,success:function(t){var e=JSON.parse(t),a="<div class='submitConfirmation'>"+e.thankyoumsg+"</div>",n=void 0;if(i.replaceWith(a),Object.keys(e).length>1&&$(".commentsList").length){var r=parseInt($("#numOfComm").text());n='<p class="smalltext commentsInfoText">'+e.created+" "+_monoLang.get("##BLOG_GENERAL_BY_LABEL##")+" "+e.author+"</p>",n+='<div class="module text">',n+='<p class="bodytext commentContent">'+e.content+"</p>",n+="</div>",$(".commentsList").append(n),$("#numOfComm").html(r+1),$("#commentsArea").hasClass("hidden")&&$("#commentsArea").removeClass("hidden")}},error:function(t){a.toggleLoading(i),413===t.status&&a.showError("requestTooLarge",i)}}),window._mtr&&window._mtr.track("comment_send")):(a.toggleLoading(i),a.showFieldErrors(i,r.fields)),!1},validateFields:function(t){var e=t.find("input, select, textarea").not(":disabled, [type=submit]"),a={valid:!0,fields:{}};e=e.filter(function(t,a){return!(("checkbox"===a.type||"radio"===a.type)&&t&&e[t-1].name===a.name)}),e.each(function(t,e){var i=$(e),n=i.attr("name").replace("[]",""),r=i.attr("type");"file"!==e.type&&i.val()&&i.val(i.val().trim()),a.fields[n]=!1,"checkbox"===r||"radio"===r?(!i.attr("data-required")||i.attr("data-required")&&(i[0].checked||i.parents(".module.form").find("[type="+i.attr("type")+"][name*="+n+"]:checked").length>0))&&(a.fields[n]=!0):"h-captcha-response"===n?i[0].value&&(a.fields[n]=!0):"select"===r?(a.fields[n]=!0,i.attr("data-required")&&$(e).children("option:first-child").is(":selected")&&(a.fields[n]="notValidSelectOption")):(!i.attr("data-required")||i.attr("data-required")&&""!==i[0].value)&&(a.fields[n]=!0,"email"===i.attr("data-type")&&i.val().length>0&&!i.val().match(/^[a-zA-Z0-9_\.\-+]+@[a-zA-Z0-9\-]+\.[a-zA-Z0-9\-\.]+$/)&&(a.fields[n]="notValidEmail"),"phone"===i.attr("data-type")&&i.val().length>0&&!i.val().match(/^[0-9\+\s\-(),.]{1,25}$/)&&(a.fields[n]="notValidPhone"))});for(var i in a.fields)if(a.fields[i]===!1||"notValidEmail"===a.fields[i]||"notValidPhone"===a.fields[i]||"notValidSelectOption"===a.fields[i]){a.valid=!1;break}return a},toggleLoading:function(t){t.toggleClass("loading")},showError:function(t,e){var a=e.attr("id"),i=void 0;switch(e.find(".error").empty(),e.find("#errors_"+a).empty().append('<div class="errors"></div>'),t){case"requestTooLarge":i="<p>* "+_monoLang.get("##MODULE_FORM_ERR_REQUESTTOOLARGE##").replace("%s","25MB")+"</p>"}e.find("div#errors_"+a+" .errors").append(i)},showFieldErrors:function(t,e){var a=t.attr("id"),i=void 0,n=[];t.find(".error").empty(),t.find("#errors_"+a).empty().append('<div class="errors"></div>');for(i in e){t.find('*[name="'+i+'"]').removeClass("requiredMark");var r="span.label_"+i;if(t.find(r).removeClass("requiredMarkLabel"),e[i]!==!0)if("h-captcha-response"!==i||e[i]!==!1){var o=t.find("label[for="+a+"_"+i+"]").text(),d=t.find('*[name="'+i+'"]').attr("placeholder")||"";o||(o=t.find(r).contents().filter(function(){return 1===this.nodeType||3===this.nodeType}).text());var c=o.replace(/\s/g,"").length>0?o:d;c=c.replace(/\*$/,"").replace(/(^\s*|\s*$)/g,""),e[i]===!1&&(t.find("div#errors_"+a+" .errors").append("<p>* '"+c+"' "+_monoLang.get("##MODULE_FORM_ERR_REQUIRED##")+"</p>"),t.find('*[name="'+i+'"]').addClass("requiredMark"),t.find(r).addClass("requiredMarkLabel"),n.push(i)),"notValidEmail"===e[i]&&(t.find("div#errors_"+a+" .errors").append("<p>* '"+c+"' "+_monoLang.get("##MODULE_FORM_ERR_EMAIL##")+"</p>"),t.find('*[name="'+i+'"]').addClass("requiredMark")),"notValidPhone"===e[i]&&(t.find("div#errors_"+a+" .errors").append("<p>* '"+c+"' "+_monoLang.get("##MODULE_FORM_ERR_PHONE##")+"</p>"),t.find('*[name="'+i+'"]').addClass("requiredMark")),"notValidSelectOption"===e[i]&&(t.find("div#errors_"+a+" .errors").append("<p>* '"+c+"' "+_monoLang.get("##MODULE_FORM_ERR_SELECT_OPTION##")+"</p>"),t.find('*[name="'+i+'"]').addClass("requiredMark"))}else t.find("div#errors_"+a+"  .errors").append("<p>* "+_monoLang.get("##MODULE_FORM_ERR_HCAPTCHA##")+"</p>")}t.find("div#errors_"+a+"  .errors").attr("tabindex","-1").trigger("focus")},setConditionals:function(t){var e=this,a=t.find(".conditional");a.length&&(a.not(".show").find("input, select, textarea").prop("disabled",!0),a.each(function(a,i){var n=$(i).attr("data-condition").match(/^([^,]+),(.+)$/);if(n&&3===n.length){var r=n[1],o=n[2],d=t.find('[name="'+r+'"][value="'+o+'"]').length?t.find('[name="'+r+'"][value="'+o+'"]'):t.find('[name="'+r+'[]"][value="'+o+'"]'),c=d.attr("type");d.is(":checked")&&$(i).addClass("show").find("input, select, textarea").prop("disabled",!1),"checkbox"===c?d.on("change",function(){$(this).is(":checked")?e.showHideConditional($(i)):e.showHideConditional($(i),1)}):"radio"===c&&t.find('[name="'+r+'"]').on("change",function(){this.value===o?e.showHideConditional($(i)):e.showHideConditional($(i),1)})}}))},showHideConditional:function(t,e){e?t.removeClass("show").find("input, select, textarea").prop("disabled",!0):t.addClass("show").find("input, select, textarea").prop("disabled",!1)},bindLabelsClick:function(t){var e=t.find('span[class*="label_field"], span[class*="label_optin_field"]');e.on("click",function(t){"SPAN"!==t.target.nodeName&&$(t.currentTarget).parents("optins")||("radio"===this.previousSibling.type?this.previousSibling.checked=!0:this.previousSibling.checked=!this.previousSibling.checked,$(this.previousSibling).trigger("focus"),$(this.previousSibling).trigger("change"))})},initHcaptcha:function(){function t(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"normal";try{var a=hcaptcha.render(t[0],{sitekey:t.attr("data-sitekey"),size:e});t.parents(".form").attr("data-widgetid",a),window.hcaptchaInitialized=!0}catch(i){this.logEvent(i),console.error("Initialize error: ",i)}}var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.$forms;e.each(function(e,a){var i=$(a).find(".h-captcha");if(!i.length)return!0;var n=i.parents("[data-animate]"),r=setInterval(function(){if($(a).width()&&(!n.length||n.is(".animationDone"))){clearInterval(r);var e=$(a).width()>304?"normal":"compact";$(a).find(".h-captcha").attr("data-invisible")&&$(a).find(".h-captcha").attr("data-invisible").length&&(e="invisible"),t(i,e)}},50)})},onlyShowOneHCaptchaBadge:function(){var t=document.querySelectorAll(".hcaptcha-badge");t.length&&$(t[t.length-1]).removeClass("hide")},initLocation:function(t){$(t).each(function(t,e){var a=!1;$(e).on("focus",function(){a||(a=new google.maps.places.Autocomplete(e))}),$(e).on("keypress",function(t){13===t.which&&t.preventDefault()})})},initDatepicker:function(t){function e(){$.fn.datetimepicker&&($.datetimepicker.setLocale(i),$(t).datetimepicker({timepicker:!1,lazyInit:!0,scrollMonth:!1,format:a}),clearInterval(n))}var a=$("body").attr("data-dateformat"),i=window._monoLoader.utils.getSiteLocale(),n=setInterval(e,200)},initNativeDatepicker:function(t){t.each(function(t,e){e.type="date"})},isDesktop:function(){return"lg"===window._monoLoader.utils.getViewport()},trimOptionsFromSelectFields:function(t){$(t).find("select")&&$(t).find("select").children().each(function(){var t=$(this).val(),e=$(this).html();$(this).val(t.trim()),$(this).html(e.trim())})},logEvent:function(t){window.dispatchEvent(new CustomEvent("errorLog",{detail:{source:this.logsSource,content:t}}))}};_monoForm.init();